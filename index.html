<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JNHS AI Lesson Plan Generator</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>

    <!-- Firebase SDKs -->
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore-compat.js"></script>

    <script>
        // --- Data & Constants ---
        const PPST_INDICATORS = [
            { code: "1.1.2", label: "Apply knowledge of content within and across curriculum teaching areas" },
            { code: "1.4.2", label: "Use a range of teaching strategies that enhance learner achievement in literacy and numeracy skills" },
            { code: "1.5.2", label: "Apply a range of teaching strategies to develop critical and creative thinking, as well as other higher-order thinking skills" },
            { code: "2.3.2", label: "Manage classroom structure to engage learners, individually or in groups, in meaningful exploration, discovery and hands-on activities within a range of physical learning environments" },
            { code: "2.6.2", label: "Manage learner behavior constructively by applying positive and non-violent discipline to ensure learning-focused environments" },
            { code: "3.1.2", label: "Use differentiated, developmentally appropriate learning experiences to address learners’ gender, needs, strengths, interests and experiences" },
            { code: "4.1.2", label: "Plan, manage and implement developmentally sequenced teaching and learning process to meet curriculum requirements and varied teaching contexts" },
            { code: "4.5.2", label: "Select, develop, organize and use appropriate teaching and learning resources, including ICT, to address learning goals" },
            { code: "5.1.2", label: "Design, select, organize and use diagnostic, formative and summative assessment strategies consistent with curriculum requirements" },
        ];

        let generatedPlanData = null;

        // --- Firebase Setup ---
        const firebaseConfig = {
            apiKey: "AIzaSyDRvLA_rS-eb9aOeUBilKEtX7d1Mu5tj4Q",
            authDomain: "tudlo-ai.firebaseapp.com",
            projectId: "tudlo-ai",
            storageBucket: "tudlo-ai.firebasestorage.app",
            messagingSenderId: "866233327777",
            appId: "1:866233327777:web:8531aca6d2e0297e1650e0",
            measurementId: "G-N74WE2N0SP"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();

        async function getGeminiApiKey() {
            try {
                const snapshot = await db.collection('geminiApiKeys').get();
                if (snapshot.empty) return null;
                const keys = snapshot.docs.map(doc => doc.data().key);
                return keys[Math.floor(Math.random() * keys.length)];
            } catch (error) {
                console.error("Error fetching configuration:", error);
                return null;
            }
        }

        // --- UI Rendering (Runs on Load) ---
        document.addEventListener('DOMContentLoaded', () => {
            // Render Indicators Checklist
            const indicatorsContainer = document.getElementById('indicators-list');
            if (indicatorsContainer) {
                PPST_INDICATORS.forEach(ind => {
                    const div = document.createElement('div');
                    div.className = "flex items-start gap-3 p-2 hover:bg-gray-600 rounded cursor-pointer group transition-colors";
                    div.innerHTML = `
                        <input type="checkbox" id="ind-${ind.code}" value="${ind.code}" checked class="mt-1 h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded">
                        <label for="ind-${ind.code}" class="text-sm cursor-pointer">
                            <span class="font-bold text-gray-200">${ind.code}</span>
                            <p class="text-gray-400 text-xs group-hover:text-gray-300">${ind.label}</p>
                        </label>
                    `;
                    indicatorsContainer.appendChild(div);
                });
            }
            
            // Initialize Icons
            if (window.lucide) {
                lucide.createIcons();
            }

            // File Upload Listeners
            const fileInput = document.getElementById('fileInput');
            const uploadBtn = document.getElementById('uploadBtn');
            const removeFileBtn = document.getElementById('removeFileBtn');
            const fileName = document.getElementById('fileName');

            if (uploadBtn) uploadBtn.addEventListener('click', () => fileInput.click());
            if (fileInput) fileInput.addEventListener('change', () => {
                if (fileInput.files.length > 0) {
                    fileName.textContent = fileInput.files[0].name;
                    removeFileBtn.classList.remove('hidden');
                }
            });
            if (removeFileBtn) removeFileBtn.addEventListener('click', () => {
                fileInput.value = '';
                fileName.textContent = 'No file chosen';
                removeFileBtn.classList.add('hidden');
            });
        });

        // --- Generation Logic ---
        async function generatePlan() {
            const grade = document.getElementById('grade').value;
            const subject = document.getElementById('subject').value;
            const topic = document.getElementById('topic').value;
            const objectives = document.getElementById('objectives').value;
            const contentStandards = document.getElementById('content_standards').value;
            const performanceStandards = document.getElementById('performance_standards').value;
            const learningCompetencies = document.getElementById('learning_competencies').value;
            const additionalInstructions = document.getElementById('additional_instructions').value;
            const language = document.getElementById('language').value;
            const fileInput = document.getElementById('fileInput');
            
            // Get selected indicators
            const selected = Array.from(document.querySelectorAll('input[type="checkbox"]:checked')).map(cb => cb.value);

            if (!subject || !topic) {
                alert("Please enter at least a Subject and Topic.");
                return;
            }

            // Show Loading
            document.getElementById('loader').style.display = 'block';
            document.getElementById('output-container').classList.add('hidden');
            
            // Contextualization Instructions
            const contextInstructions = `
                LANGUAGE INSTRUCTION:
                ${language === 'English' 
                    ? 'The entire lesson plan MUST be generated STRICTLY in English. This includes ALL teacher dialogue, student responses, and instructions. Do NOT use Tagalog, Filipino, or Taglish anywhere. Even if the context is local, the language spoken must be English. Only proper nouns (names of places, people, specific local food names) are allowed in Filipino.' 
                    : 'The entire lesson plan MUST be generated STRICTLY in Filipino (Tagalog). For technical terms that do not have a widely accepted Filipino translation, retain the English term.'
                }

                CRITICAL CONTEXTUALIZATION INSTRUCTIONS:
                1. Contextualization: All examples, activities, and materials MUST be deeply rooted in the Philippine context. Use local examples (e.g., refer to local landmarks like 'Chocolate Hills'; use Filipino names). ${language === 'English' ? 'Describe these local items in English.' : "Use local terms like 'mangga' instead of 'apple'."}
                2. Resources & ICT: Assume a typical Philippine public school setting.
                   - Use low-cost materials (manila paper, cartolina, realia) for student hands-on activities.
                   - INTEGRATE BASIC ICT: The teacher should use PowerPoint presentations and video clips (e.g., YouTube) where appropriate to support instruction (aligning with Indicator 4.5.2).
                3. Document Integration: If a document is provided, prioritize its content for the lesson subject matter.
            `;

            const prompt = `
                ${contextInstructions}
                
                CONTENT REQUIREMENTS:
                - **Detailed and Expanded:** All sections must be detailed. Avoid short sentences.
                - **Concepts:** For every concept introduced, provide a clear definition and detailed explanation.
                - **Evaluation:** For quizzes or assessments, provide specific questions (at least 5) and include the ANSWER KEY at the end of the section.
                - **Varied Activities:** Use techniques like think-pair-share, gallery walks, role-playing, etc.
                - **Objectives:** Create specific behavioral objectives (Cognitive, Psychomotor, Affective).
                - **Objectives Format:** The objectives section MUST be categorized into domains. Format exactly as:
                  At the end of the lesson, the students should be able to:
                  • (Cognitive) [Objective]
                  • (Psychomotor) [Objective]
                  • (Affective) [Objective]
                - **Learning Competencies:** MUST be sourced strictly from the DepEd MELCs (Most Essential Learning Competencies). Do not use textbook-based competencies.
                
                Create a Detailed Lesson Plan (COT-RPMS Format) for:
                Grade: ${grade}
                Subject: ${subject}
                Topic: ${topic}
                Objectives Input: ${objectives}
                Content Standards: ${contentStandards}
                Performance Standards: ${performanceStandards}
                Learning Competencies: ${learningCompetencies}
                Additional Instructions: ${additionalInstructions}
                
                ANNOTATION REQUIREMENT:
                The lesson content MUST demonstrate the following PPST indicators:
                ${selected.join(', ')}
                
                You must explicitly ANNOTATE the plan where these indicators are demonstrated.
                Start annotating indicators ONLY from the "IV. PROCEDURES" section onwards. Do NOT annotate Learning Competencies or Objectives.
                
                OUTPUT FORMAT:
                Return STRICT JSON matching the structure below.
                IMPORTANT: Put the lesson content in the "content" field. Put the PPST Code, Explanation, and Evidence in the "annotation" field. Do NOT mix them.
                IMPORTANT: Do NOT repeat the section label (e.g., "A. Reviewing...", "B. Establishing...") in the "content" field. Just write the content/activity directly.
                IMPORTANT: PPST Indicators must ONLY appear in the "annotation" field of the "proc_*" sections (Procedures). Do not put them in Objectives or Content.
                
                JSON Structure:
                {
                    "meta": { "grade": "${grade}", "subject": "${subject}", "topic": "${topic}" },
                    "sections": {
                        "content_standard": { "content": "${contentStandards || 'Generate appropriate standards'}" },
                        "performance_standard": { "content": "${performanceStandards || 'Generate appropriate standards'}" },
                        "learning_competencies": { "content": "${learningCompetencies || 'Generate appropriate MELCS competencies with code'}" },
                        "objectives": { "content": "At the end of the lesson..." },
                        "content_section": { "content": "Topic: ${topic}\\nInclude specific concepts with full definitions and meanings." },
                        "content_section": { "content": "Topic: ${topic}" },
                        "ref_tg": { "content": "Pages..." },
                        "ref_lm": { "content": "Pages..." },
                        "ref_txt": { "content": "Pages..." },
                        "ref_lr": { "content": "Link or ID..." },
                        "ref_other": { "content": "Materials (Low-cost/Localized)..." },
                        "proc_review": { "content": "Teacher asks students to recall...", "annotation": "Evidence..." },
                        "proc_purpose": { "content": "Teacher shows a picture of...", "annotation": "..." },
                        "proc_examples": { "content": "Teacher presents examples...", "annotation": "..." },
                        "proc_discuss_1": { "content": "Teacher discusses...", "annotation": "..." },
                        "proc_discuss_1": { "content": "Teacher discusses concepts, definitions, and meanings...", "annotation": "..." },
                        "proc_discuss_2": { "content": "Group activity...", "annotation": "..." },
                        "proc_mastery": { "content": "Individual practice...", "annotation": "..." },
                        "proc_app": { "content": "Application activity...", "annotation": "..." },
                        "proc_gen": { "content": "Generalization questions...", "annotation": "..." },
                        "proc_eval": { "content": "Quiz with at least 5 questions followed by the Answer Key.", "annotation": "..." },
                        "proc_add": { "content": "Remediation activity...", "annotation": "..." },
                        "remarks": { "content": "..." }
                    }
                }
                
                Ensure differentiation (3.1.2) and literacy/numeracy (1.4.2) are visible.
                The "annotation" field should follow this format strictly (do not use HTML tags):
                "PPST [Code] :\n[Explanation of how the activity meets the indicator].\nEvidence: [Specific evidence from the content]"
            `;

            try {
                const apiKey = await getGeminiApiKey();
                
                if (!apiKey) {
                    throw new Error("Failed to retrieve API configuration. Please check your connection.");
                }

                let contents = [];
                if (fileInput && fileInput.files.length > 0) {
                    const file = fileInput.files[0];
                    const base64 = await readFileAsBase64(file);
                    contents = [{
                        parts: [
                            { text: prompt },
                            { inlineData: { mimeType: file.type, data: base64 } }
                        ]
                    }];
                } else {
                    contents = [{ parts: [{ text: prompt }] }];
                }

                const response = await fetch(
                    `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-lite:generateContent?key=${apiKey}`,
                    {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            contents: contents,
                            generationConfig: { responseMimeType: "application/json" }
                        })
                    }
                );

                const data = await response.json();
                if (data.error) {
                    throw new Error(data.error.message);
                }
                
                if (data.candidates && data.candidates[0].content) {
                    let resultText = data.candidates[0].content.parts[0].text;
                    // Clean JSON
                    resultText = resultText.replace(/```json/gi, '').replace(/```/g, '').trim();
                    const firstOpen = resultText.indexOf('{');
                    const lastClose = resultText.lastIndexOf('}');
                    if (firstOpen !== -1 && lastClose !== -1) {
                        resultText = resultText.substring(firstOpen, lastClose + 1);
                    }
                    
                    generatedPlanData = JSON.parse(resultText);
                    renderPlan(generatedPlanData, selected); // Pass selected indicators for footer
                }
            } catch (error) {
                console.error("Error:", error);
                alert("Failed to generate plan. If running locally, ensure you have an internet connection and a valid API Key.");
                document.getElementById('loader').style.display = 'none';
            } finally {
                // Loader is hidden in renderPlan or error catch
            }
        };

        // --- Render Logic ---
        function renderPlan(data, selectedIndicators = []) {
            document.getElementById('loader').style.display = 'none';
            document.getElementById('output-container').classList.remove('hidden');
            document.getElementById('output-container').scrollIntoView({ behavior: 'smooth' });

            // Header
            document.getElementById('doc-subject-grade').innerText = `${data.meta.subject} ${data.meta.grade}`;
            document.getElementById('doc-topic').innerText = data.meta.topic;

            // Render Table Rows
            const tbody = document.getElementById('plan-tbody');
            tbody.innerHTML = ''; // Clear existing

            const cleanText = (text) => {
                if (!text) return '';
                // Replace bullet points '* ' with '• ' for cleaner lists
                let cleaned = text.replace(/^\s*\*\s/gm, '• ');
                // Remove any remaining asterisks (like those used for **bold**)
                cleaned = cleaned.replace(/\*/g, '');
                return cleaned.replace(/\n/g, '<br>');
            };

            const addRow = (label, contentKey, isHeader = false, isSubHeader = false, showAnnotation = false) => {
                let content = '';
                let annotation = '';
                
                // If contentKey corresponds to data
                if (data.sections[contentKey]) {
                    content = cleanText(data.sections[contentKey].content);
                    if (showAnnotation) {
                        annotation = cleanText(data.sections[contentKey].annotation);
                    }
                }

                const tr = document.createElement('tr');
                
                if (isHeader) {
                    tr.innerHTML = `<td colspan="3" class="border border-black p-2 bg-gray-200 font-bold text-center uppercase tracking-wider" style="background-color: #e5e7eb; font-weight: bold; text-align: center; text-transform: uppercase;">${label}</td>`;
                } else {
                     let labelClass = "border border-black p-2 align-top w-[25%] font-bold";
                     let labelStyle = "width: 25%; font-weight: bold; vertical-align: top;";
                     
                     if (isSubHeader) {
                        labelClass += " pl-8";
                        labelStyle += " padding-left: 2rem;";
                     }

                    tr.innerHTML = `
                        <td class="${labelClass}" style="${labelStyle}">${label}</td>
                        <td class="border border-black p-2 align-top w-[50%] whitespace-pre-wrap" style="width: 50%; vertical-align: top; white-space: pre-wrap;">${content || ''}</td>
                        <td class="border border-black p-2 align-top w-[25%] text-blue-900 bg-gray-50/50 whitespace-pre-wrap" style="width: 25%; vertical-align: top; color: #1e3a8a; background-color: #f9fafb; white-space: pre-wrap;">${annotation || ''}</td>
                    `;
                }
                tbody.appendChild(tr);
            };

            // --- I. OBJECTIVES ---
            addRow("I. OBJECTIVES", null);
            addRow("A. Content Standards", "content_standard");
            addRow("B. Performance Standards", "performance_standard");
            
            // Merge Learning Competencies and Objectives
            const lcSection = data.sections.learning_competencies || {};
            const objSection = data.sections.objectives || {};
            
            const lcContent = lcSection.content || '';
            const objContent = objSection.content || '';
            
            data.sections.merged_competencies = {
                content: lcContent + (lcContent && objContent ? '\n\n' : '') + objContent,
                annotation: ''
            };
            addRow("C. Learning Competencies / Objectives. Write the LC code for each", "merged_competencies");

            // --- II. CONTENT ---
            addRow("II. CONTENT", "content_section");

            // --- III. LEARNING RESOURCES ---
            addRow("III. LEARNING RESOURCES", null);
            addRow("A. References", null, false, false); // Subheader but acts as a label row effectively
            addRow("1. Teacher’s Guide pages", "ref_tg", false, true);
            addRow("2. Learner’s Materials pages", "ref_lm", false, true);
            addRow("3. Textbook pages", "ref_txt", false, true);
            addRow("4. Additional Materials from Learning Resource (LR) portal", "ref_lr", false, true);
            addRow("B. Other Learning Resources", "ref_other");

            // --- IV. PROCEDURES ---
            addRow("IV. PROCEDURES", null);
            addRow("A. Reviewing previous lesson or presenting the new lesson", "proc_review", false, false, true);
            addRow("B. Establishing a purpose for the lesson", "proc_purpose", false, false, true);
            addRow("C. Presenting examples/ instances of the new lesson", "proc_examples", false, false, true);
            addRow("D. Discussing new concepts and practicing new skills #1", "proc_discuss_1", false, false, true);
            addRow("E. Discussing new concepts and practicing new skills #2", "proc_discuss_2", false, false, true);
            addRow("F. Developing mastery (Leads to Formative Assessment 3)", "proc_mastery", false, false, true);
            addRow("G. Finding practical applications of concepts and skills in daily living", "proc_app", false, false, true);
            addRow("H. Making generalizations and abstractions about the lesson", "proc_gen", false, false, true);
            addRow("I. Evaluating learning", "proc_eval", false, false, true);
            addRow("J. Additional activities for application or remediation", "proc_add", false, false, true);

            // --- V. REMARKS ---
            addRow("V. REMARKS", "remarks");

            // --- VI. REFLECTION ---
            addRow("VI. REFLECTION", null);
            
            const reflectionQs = [
                { l: "A. No.of learners who earned 80% on the formative assessment.", k: "ref_a" },
                { l: "B. No.of learners who require additional activities for remediation.", k: "ref_b" },
                { l: "C. Did the remedial lessons work? No.of learners who have caught up with the lesson.", k: "ref_c" },
                { l: "D. No.of learners who continue to require remediation", k: "ref_d" },
                { l: "E. Which of my teaching strategies worked well? Why did these work?", k: "ref_e" },
                { l: "F. What difficulties did I encounter which my principal or supervisor can help me solve?", k: "ref_f" },
                { l: "G. What innovation or localized materials did I use/discover which I wish to share with other teachers?", k: "ref_g" }
            ];
            
            reflectionQs.forEach(item => {
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td class="border border-black p-2 align-top w-[25%] font-bold" style="width: 25%; font-weight: bold; vertical-align: top;">${item.l}</td>
                    <td class="border border-black p-2 align-top w-[50%]" style="width: 50%; vertical-align: top;"></td>
                    <td class="border border-black p-2 align-top w-[25%]" style="width: 25%; vertical-align: top;"></td>
                `;
                tbody.appendChild(tr);
            });

            // Footer
            const footerTr = document.createElement('tr');
            footerTr.innerHTML = `<td colspan="3" class="border border-black p-3 font-bold text-center" style="font-weight: bold; text-align: center;">To God be the Glory!!!</td>`;
            tbody.appendChild(footerTr);

            // Indicators Legend
            const footerDiv = document.getElementById('footer-indicators');
            footerDiv.innerHTML = '';
            if (selectedIndicators && selectedIndicators.length > 0) {
                 selectedIndicators.forEach(code => {
                    const ind = PPST_INDICATORS.find(i => i.code === code);
                    if(ind) {
                        const div = document.createElement('div');
                        div.className = "flex gap-2";
                        div.innerHTML = `<span class="font-mono font-bold text-blue-800">${code}</span><span>${ind.label}</span>`;
                        footerDiv.appendChild(div);
                    }
                 });
            }
        }

        // --- Helper Functions ---
        function readFileAsBase64(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onload = () => resolve(reader.result.split(',')[1]);
                reader.onerror = error => reject(error);
                reader.readAsDataURL(file);
            });
        }

        function exportToWord() {
            const subject = document.getElementById('subject').value || 'Lesson';
            const topic = document.getElementById('topic').value || 'Plan';
            const filename = `${subject}_${topic}.doc`.replace(/[\s/]/g, '_');
            
            // Get the content
            const contentDiv = document.querySelector('.document-font');
            if (!contentDiv) return;
            
            const contentHtml = contentDiv.innerHTML;
            
            const sourceHTML = `
                <html xmlns:o='urn:schemas-microsoft-com:office:office' xmlns:w='urn:schemas-microsoft-com:office:word' xmlns='http://www.w3.org/TR/REC-html40'>
                <head><meta charset='utf-8'><title>Lesson Plan</title>
                <style>
                    body { font-family: 'Times New Roman', serif; font-size: 11pt; }
                    table { border-collapse: collapse; width: 100%; border: 1px solid black; }
                    td, th { border: 1px solid black; padding: 5px; vertical-align: top; }
                    .font-bold { font-weight: bold; }
                    .text-center { text-align: center; }
                    .uppercase { text-transform: uppercase; }
                    .bg-gray-200 { background-color: #e5e7eb; }
                    .whitespace-pre-wrap { white-space: pre-wrap; }
                </style>
                </head><body>${contentHtml}</body></html>
            `;
            
            const source = 'data:application/vnd.ms-word;charset=utf-8,' + encodeURIComponent(sourceHTML);
            const fileDownload = document.createElement("a");
            document.body.appendChild(fileDownload);
            fileDownload.href = source;
            fileDownload.download = filename;
            fileDownload.click();
            document.body.removeChild(fileDownload);
        }
    </script>
    
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        #loader {
            display: none;
            position: fixed;
            z-index: 99;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            border: 8px solid #4b5563;
            border-radius: 50%;
            border-top: 8px solid #3b82f6;
            width: 60px;
            height: 60px;
            animation: spin 1.5s linear infinite;
        }
        @keyframes spin {
            0% { transform: translate(-50%, -50%) rotate(0deg); }
            100% { transform: translate(-50%, -50%) rotate(360deg); }
        }
        @media print {
            @page { size: A4; margin: 0.5in; }
            body { background: white; -webkit-print-color-adjust: exact; }
            .print\\:hidden { display: none !important; }
            .print\\:block { display: block !important; }
            #sidebar-container { display: none !important; }
            header { display: none !important; }
            .no-print { display: none !important; }
            #output-container { display: block !important; margin: 0 !important; padding: 0 !important; background: white !important; box-shadow: none !important; }
            table { page-break-inside: auto; width: 100% !important; }
            tr { page-break-inside: avoid; page-break-after: auto; }
            td { padding: 4px; }
        }
        /* Custom scrollbar */
        .custom-scrollbar::-webkit-scrollbar { width: 6px; }
        .custom-scrollbar::-webkit-scrollbar-track { background: #f1f1f1; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: #c1c1c1; border-radius: 4px; }
        .custom-scrollbar::-webkit-scrollbar-thumb:hover { background: #a8a8a8; }
        .document-font {
            font-family: "Times New Roman", Times, serif;
            font-size: 11pt;
        }
    </style>
</head>
<body class="bg-gray-900 text-gray-200">

    <div id="loader"></div>

    

    <div class="container mx-auto p-4 md:p-8">
        <header class="text-center mb-10 no-print">
            <img src="images/codexai.png" alt="CodexAI Logo" class="mx-auto h-24 w-auto" onerror="this.onerror=null;this.src='https://placehold.co/128x96/111827/ffffff?text=CodexAI';">
            <h1 class="text-4xl md:text-5xl font-bold mt-4 bg-clip-text text-transparent bg-gradient-to-r from-blue-400 to-teal-500">JNHS AI Lesson Plan Generator</h1>
            <p class="text-lg text-gray-400 mt-2">Powered by Erning</p>
        </header>

        <div class="bg-gray-800 p-6 md:p-8 rounded-2xl shadow-2xl mb-8 max-w-4xl mx-auto no-print">
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div>
                    <label for="grade" class="block text-sm font-medium text-gray-300 mb-2">Grade Level</label>
                    <select id="grade" class="w-full p-3 bg-gray-700 border border-gray-600 rounded-lg text-white focus:ring-2 focus:ring-blue-500 focus:outline-none transition">
                                <option value="Grade 1">Grade 1</option>
                                <option value="Grade 2">Grade 2</option>
                                <option value="Grade 3">Grade 3</option>
                                <option value="Grade 4">Grade 4</option>
                                <option value="Grade 5">Grade 5</option>
                                <option value="Grade 6">Grade 6</option>
                                <option value="Grade 7" selected>Grade 7</option>
                                <option value="Grade 8">Grade 8</option>
                                <option value="Grade 9">Grade 9</option>
                                <option value="Grade 10">Grade 10</option>
                                <option value="Grade 11">Grade 11</option>
                                <option value="Grade 12">Grade 12</option>
                            </select>
                </div>
                <div>
                    <label for="subject" class="block text-sm font-medium text-gray-300 mb-2">Subject</label>
                    <input id="subject" type="text" list="subjects-list" value="Science" class="w-full p-3 bg-gray-700 border border-gray-600 rounded-lg text-white focus:ring-2 focus:ring-blue-500 focus:outline-none transition">
                            <datalist id="subjects-list">
                                <option value="Mathematics"></option>
                                <option value="Science"></option>
                                <option value="English"></option>
                                <option value="Filipino"></option>
                                <option value="Araling Panlipunan"></option>
                                <option value="MAPEH"></option>
                                <option value="TLE"></option>
                                <option value="Values Education"></option>
                    </datalist>
                </div>
                <div>
                    <label for="language" class="block text-sm font-medium text-gray-300 mb-2">Language Output</label>
                    <select id="language" class="w-full p-3 bg-gray-700 border border-gray-600 rounded-lg text-white focus:ring-2 focus:ring-blue-500 focus:outline-none transition">
                            <option value="English">English</option>
                            <option value="Filipino">Filipino</option>
                    </select>
                </div>
                <div>
                    <label for="topic" class="block text-sm font-medium text-gray-300 mb-2">Topic</label>
                    <input id="topic" type="text" value="" class="w-full p-3 bg-gray-700 border border-gray-600 rounded-lg text-white focus:ring-2 focus:ring-blue-500 focus:outline-none transition" placeholder="e.g., The Scientific Method">
                </div>
                <div class="md:col-span-2">
                    <label class="block text-sm font-medium text-gray-300 mb-2">Upload Learning Material (Optional, PDF/DOCX)</label>
                    <div class="flex items-center gap-2">
                        <input type="file" id="fileInput" class="hidden" accept=".pdf, .docx">
                        <button id="uploadBtn" type="button" class="bg-gray-600 hover:bg-gray-500 text-white px-4 py-2 rounded-lg text-sm font-medium transition-colors border border-gray-500">Choose File</button>
                        <span id="fileName" class="text-xs text-gray-400 truncate flex-1">No file chosen</span>
                        <button id="removeFileBtn" type="button" class="text-red-500 hover:text-red-700 hidden"><i data-lucide="x" class="w-4 h-4"></i></button>
                    </div>
                    <p class="text-xs text-gray-400 mt-1">The AI will use this document to contextualize the lesson.</p>
                </div>
                <div>
                    <label for="content_standards" class="block text-sm font-medium text-gray-300 mb-2">Content Standards (Optional)</label>
                    <textarea id="content_standards" rows="3" class="w-full p-3 bg-gray-700 border border-gray-600 rounded-lg text-white focus:ring-2 focus:ring-blue-500 focus:outline-none transition" placeholder="e.g., The learner demonstrates understanding of..."></textarea>
                </div>
                <div>
                    <label for="performance_standards" class="block text-sm font-medium text-gray-300 mb-2">Performance Standards (Optional)</label>
                    <textarea id="performance_standards" rows="3" class="w-full p-3 bg-gray-700 border border-gray-600 rounded-lg text-white focus:ring-2 focus:ring-blue-500 focus:outline-none transition" placeholder="e.g., The learner is able to..."></textarea>
                </div>
                <div class="md:col-span-2">
                    <label for="learning_competencies" class="block text-sm font-medium text-gray-300 mb-2">Learning Competencies (Optional)</label>
                    <textarea id="learning_competencies" rows="2" class="w-full p-3 bg-gray-700 border border-gray-600 rounded-lg text-white focus:ring-2 focus:ring-blue-500 focus:outline-none transition" placeholder="e.g., MELCS Code: S7LT-IIa-1..."></textarea>
                </div>
                <div class="md:col-span-2">
                    <label for="objectives" class="block text-sm font-medium text-gray-300 mb-2">Objectives</label>
                    <textarea id="objectives" rows="4" class="w-full p-3 bg-gray-700 border border-gray-600 rounded-lg text-white focus:ring-2 focus:ring-blue-500 focus:outline-none transition" placeholder="e.g.,&#10;Define the scientific method.&#10;Identify the steps..."></textarea>
                </div>
                <div class="md:col-span-2">
                    <label for="additional_instructions" class="block text-sm font-medium text-gray-300 mb-2">Additional Instructions (Optional)</label>
                    <textarea id="additional_instructions" rows="2" class="w-full p-3 bg-gray-700 border border-gray-600 rounded-lg text-white focus:ring-2 focus:ring-blue-500 focus:outline-none transition" placeholder="Any specific requirements..."></textarea>
                </div>
                
                <div class="md:col-span-2">
                    <label class="block text-sm font-medium text-gray-300 mb-2">PPST Indicators</label>
                    <div id="indicators-list" class="space-y-2 max-h-64 overflow-y-auto pr-2 custom-scrollbar bg-gray-700 p-4 rounded-lg">
                    <!-- Injected via JS -->
                    </div>
                </div>
            </div>
            <div class="mt-8 text-center">
                <button onclick="generatePlan()" class="w-full md:w-auto bg-gradient-to-r from-blue-500 to-teal-600 hover:from-blue-600 hover:to-teal-700 text-white font-bold py-3 px-10 rounded-lg transition-all transform hover:scale-105 shadow-lg">
                    Generate Lesson Plan
            </button>
            </div>
        </div>

        <div id="output-container" class="hidden mt-12 bg-gray-800 p-4 md:p-6 rounded-2xl shadow-2xl">
                <!-- Toolbar -->
            <div class="text-center mb-6 no-print">
                 <button onclick="exportToWord()" class="bg-gradient-to-r from-green-500 to-emerald-600 hover:from-green-600 hover:to-emerald-700 text-white font-bold py-2 px-6 rounded-lg transition-all transform hover:scale-105 shadow-md flex items-center gap-2 mx-auto">
                            <i data-lucide="download" class="w-4 h-4"></i> Download .doc
                        </button>
                </div>

                <!-- Actual Document -->
            <div class="p-8 lg:p-12 max-w-[210mm] mx-auto bg-white min-h-[297mm] leading-relaxed text-gray-900 document-font shadow-lg rounded-lg">
                    <!-- Header -->
                    <div class="mb-6 text-center font-sans">
                        <h1 class="text-2xl font-bold uppercase tracking-wide text-center" style="text-align: center;">Lesson Plan</h1>
                        <div class="mt-2 text-gray-600 text-center" style="text-align: center;">
                            <span id="doc-subject-grade">Subject Grade</span>
                            <span style="margin: 0 15px;">•</span>
                            <span id="doc-topic">Topic</span>
                        </div>
                    </div>

                    <!-- The Table -->
                    <div class="overflow-x-auto">
                        <table class="w-full border-collapse border border-black">
                            <thead>
                                <tr class="bg-gray-100" style="background-color: #f3f4f6;">
                                    <th class="border border-black p-3 text-left w-[25%] font-bold uppercase" style="width: 25%; font-weight: bold; text-transform: uppercase; text-align: left; border: 1px solid black;">Section Labels</th>
                                    <th class="border border-black p-3 text-center w-[50%] font-bold uppercase" style="width: 50%; font-weight: bold; text-transform: uppercase; text-align: center; border: 1px solid black;">Content</th>
                                    <th class="border border-black p-3 text-center w-[25%] font-bold uppercase" style="width: 25%; font-weight: bold; text-transform: uppercase; text-align: center; border: 1px solid black;">NCOI/COI Evidence & PMES Annotation</th>
                                </tr>
                            </thead>
                            <tbody id="plan-tbody">
                                <!-- Rows injected here -->
                            </tbody>
                        </table>
                    </div>

                    <!-- Footer Indicators -->
                    <div class="mt-8 pt-6 border-t border-gray-200 text-xs text-gray-500 print:block font-sans">
                        <p class="font-bold mb-2">Annotated PPST Indicators in this Plan:</p>
                        <div id="footer-indicators" class="grid grid-cols-1 md:grid-cols-2 gap-x-4 gap-y-1">
                            <!-- Injected via JS -->
                        </div>
                    </div>
                </div>
        </div>
    </div>

</body>
</html>